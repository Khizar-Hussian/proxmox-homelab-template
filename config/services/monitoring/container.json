{
  "_description": "Monitoring Stack Service Container Configuration",
  "_purpose": "Prometheus metrics collection and Grafana visualization",
  "_features": ["Service monitoring", "alerting", "dashboards", "metrics storage"],
  "_monitoring": ["Self-monitoring with health checks", "performance metrics"],
  
  "container": {
    "id": 145,
    "hostname": "monitoring",
    "ip": "10.0.0.45",
    "resources": {
      "cpu": 2,
      "memory": 2048,
      "disk": 20,
      "_units": {
        "memory": "MB",
        "disk": "GB"
      }
    },
    "features": [
      "nesting=1"
    ],
    "nfs_mounts": [
      {
        "source": "/mnt/tank/monitoring", 
        "target": "/data/persistent"
      }
    ],
    "_note": "Optional NFS mount for long-term metrics storage"
  },
  
  "certificates": {
    "domains": [
      "grafana.${DOMAIN}",
      "prometheus.${DOMAIN}",
      "alertmanager.${DOMAIN}"
    ],
    "_description": "SSL certificates for all monitoring services"
  },
  
  "external_access": {
    "cloudflare_tunnel": {
      "enabled": true,
      "subdomains": [
        "grafana",
        "prometheus",
        "alertmanager"
      ]
    },
    "internal_access": {
      "ports": [
        {
          "port": 3000,
          "service": "grafana",
          "path": "/"
        },
        {
          "port": 9090,
          "service": "prometheus",
          "path": "/"
        },
        {
          "port": 9093,
          "service": "alertmanager",
          "path": "/"
        }
      ]
    }
  },
  
  "service": {
    "type": "monitoring",
    "category": "infrastructure",
    "priority": 4,
    "_priority_note": "Deploy after core services are up",
    "health_check": {
      "enabled": true,
      "endpoints": [
        {
          "service": "prometheus",
          "port": 9090,
          "path": "/-/healthy"
        },
        {
          "service": "grafana",
          "port": 3000,
          "path": "/api/health"
        },
        {
          "service": "alertmanager",
          "port": 9093,
          "path": "/-/healthy"
        }
      ],
      "interval": 30
    },
    "monitoring": {
      "enabled": true,
      "metrics_ports": [
        9090,
        3000,
        9093
      ],
      "dashboards": [
        "prometheus-overview",
        "grafana-analytics"
      ],
      "_note": "Self-monitoring - monitoring the monitoring!"
    }
  },
  
  "backup": {
    "enabled": true,
    "paths": [
      "/opt/monitoring/prometheus/data",
      "/opt/monitoring/grafana/data",
      "/opt/monitoring/alertmanager/data"
    ],
    "schedule": "daily",
    "retention": "30d",
    "_paths_description": {
      "/opt/monitoring/prometheus/data": "Metrics data",
      "/opt/monitoring/grafana/data": "Dashboards and settings",
      "/opt/monitoring/alertmanager/data": "Alert configuration"
    }
  }
}